<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.togest.dao.C4InfoDao">
	<resultMap id="BaseResultMap" type="com.togest.domain.C4InfoDTO">
		<id column="id" property="id" />
		<result column="plan_id" property="planId"/>
		<result column="source" property="source" />
		<result column="package_name" property="packageName" />
		<result column="package_path" property="packagePath" />
		<result column="start_time" property="startTime" />
		<result column="end_time" property="endTime" />
		<result column="start_poleno" property="startPoleno" />
		<result column="end_poleno" property="endPoleno" />
		<result column="camera_number" property="cameraNumber" />
		<result column="support_camera_number" property="supportCameraNumber" />
		<result column="droppers_camera_number" property="droppersCameraNumber" />
		<result column="append_camera_number" property="appendCameraNumber" />
		<result column="davit_camera_number" property="davitCameraNumber" />
		<result column="rawdata_status" property="rawdataStatus" />
		<result column="defectdata_status" property="defectdataStatus" />
		<result column="sort" property="sort" />
		<result property="lineName" column="lineName"/>
		
		<result property="checkDate" column="check_date"/>
		<result property="lineId" column="line_id"/>
		<result property="direction" column="direction"/>
		<result property="startStation" column="start_station"/>
		<result property="endStation" column="end_station"/>
		<result property="startStationName" column="startStationName"/>
		<result property="endStationName" column="endStationName"/>
		<result property="analyst" column="analyst"/>
		<result property="analyDate" column="analy_date"/>
		<result property="uploadPerson" column="upload_person"/>
		<result property="uploadDate" column="upload_date"/>
		<result property="dataSize" column="data_size"/>
		<result property="packageName" column="package_name"/>
		<result property="packagePath" column="package_path"/>
		<result property="analyStatus" column="analy_status"/>
		<result property="defectDataStatus" column="defect_data_status"/>
		<result property="rawdataStatus" column="rawdata_status"/>
		<result property="systemId" column="system_id"/>
		<result property="sectionId" column="section_id"/>
	</resultMap>

	<sql id="Base_Column_List">
		a.id,a.plan_id,a.source, a.start_time, a.end_time, a.start_poleno, a.end_poleno, 
		a.camera_number, a.support_camera_number, a.droppers_camera_number, a.append_camera_number, 
		a.davit_camera_number, a.sort,pl.name as lineName,
		a.check_date,
    	a.line_id,
    	a.direction,
    	a.start_station,
    	a.end_station,
    	a.analyst,
    	a.analy_date,
    	a.upload_person,
    	a.upload_date,
    	a.data_size,
    	a.package_name,
    	a.package_path,
    	a.analy_status,
    	a.defect_data_status,
    	a.rawdata_status,
    	a.system_id,
    	a.section_id,
    	psa1.name as startStationName ,
    	psa2.name as endStationName
	</sql>
	
	<sql id="Base_Table">
		6c_c4_info a
		left join p_line pl on a.line_id = pl.id
		left join p_supply_arm psa1 on a.start_station = psa1.id
		left join p_supply_arm psa2 on a.end_station = psa2.id
	</sql>
	<sql id="baseConditions">
		<if test="checkDate != null"> 
			and a.check_date = #{checkDate}
		</if>
		<if test="lineId != null"> 
			and a.line_id = #{lineId}
		</if>
		<if test="direction != null"> 
			and a.direction = #{direction}
		</if>
		<if test="startStation != null"> 
			and a.start_station = #{startStation}
		</if>
		<if test="endStation != null"> 
			and a.end_station = #{endStation}
		</if>
		<if test="analyst != null"> 
			and a.analyst = #{analyst}
		</if>
		<if test="analyDate != null"> 
			and a.analy_date = #{analyDate}
		</if>
		<if test="uploadPerson != null"> 
			and a.upload_person = #{uploadPerson}
		</if>
		<if test="uploadDate != null"> 
			and a.upload_date = #{uploadDate}
		</if>
		<if test="dataSize != null"> 
			and a.data_size = #{dataSize}
		</if>
		<if test="packageName != null"> 
			and a.package_name = #{packageName}
		</if>
		<if test="packagePath != null"> 
			and a.package_path = #{packagePath}
		</if>
		<if test="analyStatus != null"> 
			and a.analy_status = #{analyStatus}
		</if>
		<if test="defectDataStatus != null"> 
			and a.defect_data_status = #{defectDataStatus}
		</if>
		<if test="rawdataStatus != null"> 
			and a.rawdata_status = #{rawdataStatus}
		</if>
		<if test="systemId != null"> 
			and a.system_id = #{systemId}
		</if>
		<if test="sectionId != null"> 
			and a.section_id = #{sectionId}
		</if>
    </sql>

	<select id="getByKey" resultMap="BaseResultMap" parameterType="java.lang.String">
		select distinct
		<include refid="Base_Column_List" />
		from
		<include refid="Base_Table" />
		where
		a.del_flag = 0
		and a.id = #{id}
	</select>
	
	<select id="findC4InfoDTO" resultMap="BaseResultMap" parameterType="java.lang.String">
		select distinct
		<include refid="Base_Column_List" />
		from
		<include refid="Base_Table" />
		<where>
			<include refid="baseConditions"></include>
		
			<if test="checkDate != null">
				and a.check_date = #{checkDate}
			</if>
			and a.del_flag=0
		</where>
	</select>
	
	<select id="findC4InfoDTOList" resultMap="BaseResultMap" parameterType="com.togest.request.CheckQueryFilter">
		select distinct
		<include refid="Base_Column_List" />
		from
		<include refid="Base_Table" />
		<where>
			<if test="beginCheckDate != null">
				and a.check_date &gt;= #{beginCheckDate}
			</if>
			<if test="endCheckDate != null">
				and a.check_date &lt;= #{endCheckDate}
			</if>
			<include refid="baseConditions"></include>
			and a.del_flag=0
		</where>
		order by a.check_date desc
	</select>

	<insert id="insert" parameterType="com.togest.domain.C4Info">
		insert into 6c_c4_info (
			id, plan_id,source, start_time, end_time, start_poleno, end_poleno, 
			camera_number, support_camera_number, droppers_camera_number, append_camera_number, 
			davit_camera_number,  create_ip, create_by, create_date,
			check_date,
            line_id,
            direction,
            start_station,
            end_station,
            analyst,
            analy_date,
            upload_person,
            upload_date,
            data_size,
            package_name,
            package_path,
            analy_status,
            defect_data_status,
            rawdata_status,
            system_id,
            section_id
            <if test="sort!=null">,sort</if>
		)
		values(
			#{id},#{planId}, #{source},  #{startTime}, #{endTime}, #{startPoleno}, #{endPoleno}, 
			#{cameraNumber}, #{supportCameraNumber}, #{droppersCameraNumber}, #{appendCameraNumber}, 
			#{davitCameraNumber},  #{createIp}, #{createBy}, #{createDate},
			#{checkDate},
			#{lineId},
			#{direction},
			#{startStation},
			#{endStation},
			#{analyst},
			#{analyDate},
			#{uploadPerson},
			#{uploadDate},
			#{dataSize},
			#{packageName},
			#{packagePath},
			#{analyStatus},
			#{defectDataStatus},
			#{rawdataStatus},
			#{systemId},
			#{sectionId}
			<if test="sort!=null">,#{sort}</if>		
		)
	</insert>

	<update id="updateDefectStatus" parameterType="java.util.Map">
		update 6c_c4_info
		set
		defectdata_status = #{defectdataStatus}
		where
		id = #{id}
	</update>

	<update id="update" parameterType="com.togest.domain.C4Info">
		update 6c_c4_info
		<trim prefix="set" suffixOverrides=",">
			<if test="source != null">
				source = #{source}, 
			</if>
			<if test="startTime != null">
				start_time = #{startTime}, 
			</if>
			<if test="endTime != null">
				end_time = #{endTime}, 
			</if>
			<if test="startPoleno != null">
				start_poleno = #{startPoleno}, 
			</if>
			<if test="endPoleno != null">
				end_poleno = #{endPoleno}, 
			</if>
			<if test="cameraNumber != null">
				camera_number = #{cameraNumber}, 
			</if>
			<if test="supportCameraNumber != null">
				support_camera_number = #{supportCameraNumber}, 
			</if>
			<if test="droppersCameraNumber != null">
				droppers_camera_number = #{droppersCameraNumber}, 
			</if>
			<if test="appendCameraNumber != null">
				append_camera_number = #{appendCameraNumber}, 
			</if>
			<if test="davitCameraNumber != null">
				davit_camera_number = #{davitCameraNumber}, 
			</if>
			<if test="updateIp != null">
				update_ip = #{updateIp},
			</if>
			<if test="updateBy != null">
				update_by = #{updateBy},
			</if>
			<if test="updateDate != null">
				update_date = #{updateDate},
			</if>
			
				<if test="checkDate != null"> 
			 check_date = #{checkDate},
		</if>
		<if test="lineId != null"> 
			 line_id = #{lineId},
		</if>
		<if test="direction != null"> 
			 direction = #{direction},
		</if>
		<if test="startStation != null"> 
			 start_station = #{startStation},
		</if>
		<if test="endStation != null"> 
			 end_station = #{endStation},
		</if>
		<if test="analyst != null"> 
			 analyst = #{analyst},
		</if>
		<if test="analyDate != null"> 
			 analy_date = #{analyDate},
		</if>
		<if test="uploadPerson != null"> 
			 upload_person = #{uploadPerson},
		</if>
		<if test="uploadDate != null"> 
			 upload_date = #{uploadDate},
		</if>
		<if test="dataSize != null"> 
			 data_size = #{dataSize},
		</if>
		<if test="packageName != null"> 
			 package_name = #{packageName},
		</if>
		<if test="packagePath != null"> 
			 package_path = #{packagePath},
		</if>
		<if test="analyStatus != null"> 
			 analy_status = #{analyStatus},
		</if>
		<if test="defectDataStatus != null"> 
			 defect_data_status = #{defectDataStatus},
		</if>
		<if test="rawdataStatus != null"> 
			 rawdata_status = #{rawdataStatus},
		</if>
		<if test="systemId != null"> 
			 system_id = #{systemId},
		</if>
		<if test="sectionId != null"> 
			 section_id = #{sectionId},
		</if>
		</trim>
		where
		id = #{id}
	</update>
	
	<update id="deleteFalses" parameterType="java.util.Map">
		update 6c_c4_info
		set
		del_flag = 1,
		delete_ip = #{deleteIp},
		delete_by = #{deleteBy},
		delete_date = #{deleteDate}
		where id
		in
		<foreach item="item" collection="ids" separator="," open="("
			close=")" index="">
			#{item}
		</foreach>
	</update>
	<update id="deleteByKey" parameterType="java.lang.String">
		update 6c_c4_info
		set
		del_flag = 1,
		delete_date = NOW()
		where id
		in
		<foreach item="item" collection="ids.split(',')" separator="," open="("
			close=")" index="">
			#{item}
		</foreach>
	</update>
	
	<update id="deleteFalsesByPlanBaseId" parameterType="java.util.Map">
		update 6c_c4_info
		set
		del_flag = 1,
		delete_ip = #{deleteIp},
		delete_by = #{deleteBy},
		delete_date = #{deleteDate}
		where 
		plan_id in (select pd.id from 6c_plan_detail pd Left join 6c_plan_base pb on pd.plan_base_id=pb.id where pb.id in
		<foreach item="item" collection="ids" separator="," open="("
			close=")" index="">
			#{item}
		</foreach>
		)
	</update>
	<update id="deleteFalsesByPlanExecuteId" parameterType="java.util.Map">
		update 6c_c4_info
		set
		del_flag = 1,
		delete_ip = #{deleteIp},
		delete_by = #{deleteBy},
		delete_date = #{deleteDate}
		where 
		plan_id in (select pd.id from 6c_plan_detail pd Left join 6c_plan_execute pe on pe.plan_detail_id=pd.id 
		where pe.id in
		<foreach item="item" collection="ids" separator="," open="("
			close=")" index="">
			#{item}
		</foreach>
		)
	</update>
</mapper>