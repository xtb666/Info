<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.togest.dao.CheckTrainDao">
	<resultMap id="BaseResultMap" type="com.togest.domain.CheckTrainDTO">
		<id column="id" property="id" />
		<result column="train_num" property="trainNum" />
		<result column="train_unit" property="trainUnit" />
		<result column="dept_id" property="deptId" />
		<result column="system_id" property="systemId" />
		<result column="manufactor" property="manufactor" />
		<result column="telephone" property="telephone" />
		<result column="sort" property="sort" />
		<result column="section_id" property="sectionId" />
		<result column="section_id" property="sectionId" />
		<result column="fault_record" property="faultRecord" />
		<result column="deptName" property="deptName" />
		<result column="systemName" property="systemName" />
	</resultMap>

	<sql id="Base_Column_List">
		a.id, a.train_num, a.train_unit, a.dept_id, a.system_id,
		a.manufactor,
		a.telephone, a.sort, a.section_id,a.fault_record,p.name
		as deptName,s.name as systemName
	</sql>

	<sql id="Base_Table">
		6c_check_train a
		left join p_department p on p.id =
		a.dept_id
		left join 6c_system s on s.id = a.system_id
	</sql>

	<select id="getByKey" resultMap="BaseResultMap" parameterType="java.lang.String">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="Base_Table" />
		where
		a.id = #{id}
		and a.del_flag = 0
	</select>
	<select id="getByEntity" resultMap="BaseResultMap" parameterType="com.togest.domain.CheckTrainDTO">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="Base_Table" />
		<where>
		<if test="trainNum != null">
				and a.train_num = #{trainNum}
			</if>
			<if test="trainUnit != null">
				and a.train_unit = #{trainUnit}
			</if>
			<if test="deptId != null">
				and a.dept_id = #{deptId}
			</if>
			<if test="systemId != null">
				and a.system_id = #{systemId}
			</if>
			<if test="manufactor != null">
				and a.manufactor = #{manufactor}
			</if>
			<if test="telephone != null">
				and a.telephone = #{telephone}
			</if>
			<if test="sort != null">
				and a.sort = #{sort}
			</if>
			<if test="sectionId != null">
				and a.section_id = #{sectionId}
			</if>
			and a.del_flag=0
		</where>
	</select>

	<select id="findList" resultMap="BaseResultMap"
		parameterType="com.togest.request.PlanQueryFilter">
		select
		<include refid="Base_Column_List" />
		from
		<include refid="Base_Table" />
		<where>
			<if test="trainNum != null">
				and a.train_num like  '%${trainNum}%'
			</if>
			<if test="trainUnit != null">
				and a.train_unit = #{trainUnit}
			</if>
			<if test="deptId != null">
				and a.dept_id = #{deptId}
			</if>
			<if test="systemId != null">
				and a.system_id = #{systemId}
			</if>
			<if test="manufactor != null">
				and a.manufactor = #{manufactor}
			</if>
			<if test="telephone != null">
				and a.telephone = #{telephone}
			</if>
			<if test="sort != null">
				and a.sort = #{sort}
			</if>
			<if test="sectionId != null">
				and a.section_id = #{sectionId}
			</if>
			and a.del_flag=0
		</where>
		order by train_num
	</select>

	<insert id="insert" parameterType="com.togest.domain.CheckTrainDTO">
		insert into 6c_check_train
		(id, train_num, train_unit,
		dept_id, system_id, manufactor,
		telephone, section_id,
		del_flag, create_ip, create_by,
		create_date,
		fault_record<if test="sort!=null or sort==0">,sort</if>)
		values (#{id}, #{trainNum},
		#{trainUnit},
		#{deptId},
		#{systemId}, #{manufactor},
		#{telephone},
		#{sectionId},
		#{delFlag}, #{createIp}, #{createBy},
		#{createDate}, #{faultRecord}<if test="sort!=null or sort==0">,#{sort}</if>)
	</insert>

	<update id="update" parameterType="com.togest.domain.CheckTrainDTO">
		update 6c_check_train
		set 
		<if test="sort!=null or sort==0">sort=#{sort},</if>
		train_num = #{trainNum},
		train_unit =
		#{trainUnit},
		dept_id =
		#{deptId},
		system_id =
		#{systemId},
		manufactor = #{manufactor},
		telephone
		=
		#{telephone},
		section_id =
		#{sectionId},
		update_ip =
		#{updateIp},
		update_by =
		#{updateBy},
		update_date = #{updateDate}
		where
		id
		= #{id}
	</update>

	<update id="deleteFalses" parameterType="java.util.Map">
		update 6c_check_train
		set
		del_flag = 1,
		delete_ip = #{deleteIp},
		delete_by =
		#{deleteBy},
		delete_date = #{deleteDate}
		where id
		in
		<foreach item="item" collection="ids" separator="," open="("
			close=")" index="">
			#{item}
		</foreach>
	</update>

</mapper>